#####   BUSCO   #####

configfile: "config.yaml"

# rule all:
# 	input:
 		# expand("reports/BUSCO/{sample}/run_redundans_platanus/short_summary_{sample}.txt", sample=config["sample"]),
		# expand("reports/BUSCO/{sample}/run_redundans_spades/short_summary_{sample}.txt", sample=config["sample"]),
		# expand("reports/BUSCO/{sample}/run_platanus_gapclosed/short_summary_{sample}.txt", sample=config["sample"])


rule BUSCOing_redundans_platanus:
        conda:
                "../envs/BUSCO.yaml"
	input:
		"data/assemblies/redundans/{sample}/platanus/scaffolds.filled.fa"
	output:
		"reports/BUSCO/{sample}/run_redundans_platanus/short_summary_{sample}.txt"
	params:
		pfx="redundans_platanus",
		db="../BUSCO/nematoda_odb10",
		mode="genome"
	shell:
		"busco \
		-i {input} \
		-o {params.pfx} \
		-l {params.db} \
		-m {params.mode} -f \
		-c 14 \
		&& mv \
		{params.pfx}/ \
		reports/BUSCO/"

rule BUSCOing_redundans_spades:
       	conda:
       	       	"../envs/BUSCO.yaml"
	input:
		"data/assemblies/redundans/{sample}/spades/scaffolds.filled.fa"
	output:
		"reports/BUSCO/{sample}/run_redundans_spades/short_summary_{sample}.txt"
	params:
		pfx="redundans_spades",
		db="../BUSCO/nematoda_odb10",
		mode="genome"
	shell:
		"busco \
		-i {input} \
		-o {params.pfx} \
		-l {params.db} \
		-m {params.mode} -f \
		-c 14 \
		&& mv \
		{params.pfx}/ \
		reports/BUSCO/"

rule BUSCOing_platanus_gapclosed:
       	conda:
       	       	"../envs/BUSCO.yaml"
	input:
		"data/assemblies/platanus/gapclosed/{sample}_gapClosed.fa"
	output:
		"reports/BUSCO/{sample}/run_platanus_gapclosed/short_summary_{sample}.txt"
	params:
		pfx="platanus_gapclosed",
		db="../BUSCO/nematoda_odb10",
		mode="genome"
	shell:
		"busco \
		-i {input} \
		-o {params.pfx} \
		-l {params.db} \
		-m {params.mode} -f \
		-c 14 \
		&& mv \
		{params.pfx}/ \
		reports/BUSCO/"

rule quast:
    conda:
        "../envs/quast.yaml"
    input:
        plat_ass = "data/assemblies/platanus/assemble/{sample}{plat_out}",
        plat_gc = "data/assemblies/platanus/gapclosed/{sample}_gapClosed.fa",
        spades = "data/assemblies/spades/{sample}/scaffolds.fasta",
        platass_redun = "data/assemblies/redundans/{sample}/platanus/scaffolds.filled.fa",
        platgc_redun = "data/assemblies/redundans/{sample}/platanusgc/scaffolds.filled.fa",
        spades_redun = "data/assemblies/redundans/{sample}/spades/scaffolds.filled.fa"
    output:
        ""
    shell:
        "quast "
